<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BuildNest Chat</title>
<style>
  :root {
    --primary: #7C3AED;
    --secondary: #0EA5E9;
    --accent: #F59E0B;
    --light: #F1F5F9;
    --white: #FFFFFF;
    --gray: #212121;
    --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
  }
  body { font-family: Arial; background: var(--light); padding: 20px; }
  #chat { max-width: 500px; margin: auto; border: 1px solid var(--gray); background: var(--white); border-radius: 8px; padding: 10px; box-shadow: var(--shadow); }
  .message { margin: 5px 0; padding: 8px 12px; border-radius: 15px; max-width: 80%; }
  .sent { background: var(--primary); color: var(--white); margin-left: auto; text-align: right; }
  .received { background: var(--secondary); color: var(--white); margin-right: auto; text-align: left; }
  form { display: flex; margin-top: 10px; }
  input { flex: 1; padding: 8px; border-radius: 5px; border: 1px solid var(--gray); }
  button { margin-left: 5px; padding: 8px 12px; background: var(--accent); border: none; border-radius: 5px; color: var(--white); cursor: pointer; }
</style>
</head>
<body>

<h2>Chat with User</h2>
<div id="chat"></div>

<form id="chatForm">
  <input type="text" id="message" placeholder="Type a message" required />
  <button type="submit">Send</button>
</form>

<script>
const API_BASE = "http://localhost:3000";

// Example: logged in user = 1, chatting with user = 2
const sender_id = 1;
const receiver_id = 2;

const chatDiv = document.getElementById("chat");
const form = document.getElementById("chatForm");

// Load conversation
async function loadMessages() {
  const res = await fetch(`${API_BASE}/messages/${sender_id}/${receiver_id}`);
  const messages = await res.json();
  chatDiv.innerHTML = messages.map(m =>
    `<div class="message ${m.sender_id == sender_id ? 'sent' : 'received'}">${m.message}</div>`
  ).join("");
  chatDiv.scrollTop = chatDiv.scrollHeight;
}

// Send new message
form.addEventListener("submit", async e => {
  e.preventDefault();
  const message = document.getElementById("message").value;
  await fetch(`${API_BASE}/messages`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ sender_id, receiver_id, message })
  });
  form.reset();
  loadMessages();
});

// Auto-refresh every 2 seconds
setInterval(loadMessages, 2000);
loadMessages();
</script>

</body>
</html>
